# This Dockerfile creates an image based on the Zulu open jdk.
# Business Wire's certificates are added to the JDK,
# and Maven is installed.

FROM azul/zulu-openjdk-alpine:17.0.9-17.46.19-x86

ARG MAVEN_VERSION=3.8.8
ARG MAVEN_BASE_URL=https://dlcdn.apache.org/maven/maven-3/${MAVEN_VERSION}/binaries
ARG MAVEN_PACKAGE=apache-maven-${MAVEN_VERSION}-bin.tar.gz
ARG OLDPASS=changeit
ARG NEWPASS=101north

RUN apk --no-cache upgrade

# Add BW root certificates to keystore 
COPY certs/* /certs/
RUN keytool -storepasswd -cacerts -storepass $OLDPASS -new $NEWPASS 
RUN keytool -import -cacerts -storepass $NEWPASS -noprompt -alias businesswirerootca -file /certs/bwrootca.cer 
RUN keytool -import -cacerts -storepass $NEWPASS -noprompt -alias businesswirerootcaold -file /certs/bwrootca_old.cer 
RUN keytool -import -cacerts -storepass $NEWPASS -noprompt -alias businesswirejira -file /certs/jira.cer 
RUN rm -fr /certs


# Download and install maven
RUN mkdir -p /opt/businesswire \
  && wget -P /opt/businesswire ${MAVEN_BASE_URL}/${MAVEN_PACKAGE} \
  && tar -zxf /opt/businesswire/${MAVEN_PACKAGE} -C /opt/businesswire \
  && rm -f ${MAVEN_PACKAGE} \
  && ln -s /opt/businesswire/apache-maven-${MAVEN_VERSION}/bin/mvn /usr/local/bin/mvn \
  && mkdir -p /root/.m2

# Add the maven settings file for "builder" user
COPY  builder-settings.xml /root/.m2/settings.xml
ENV MAVEN_HOME /opt/businesswire/apache-maven-${MAVEN_VERSION}


